keyboard: "glove80"
description: "MoErgo Glove80 split ergonomic keyboard"
vendor: "MoErgo"
key_count: 80

# Include common configurations
includes:
  - "config/common/default_includes.yaml"
  - "config/common/formatting.yaml"
  - "config/common/bluetooth_kconfig.yaml"
  - "config/common/power_kconfig.yaml"
  - "config/display/defaults.yaml"
  - "config/display/glove80_layout.yaml"

# Include behavior configurations
behaviors:
  includes:
    - "config/behaviors/zmk_core.yaml"
    - "config/behaviors/zmk_bluetooth.yaml"
    - "config/behaviors/zmk_macros.yaml"
    - "config/behaviors/moergo_extended.yaml"

# Include ZMK configuration
zmk:
  includes:
    - "config/zmk/validation_limits.yaml"
    - "config/zmk/patterns.yaml"

# Compile method configurations
compile_methods:
  - method_type: docker
    image: moergo-zmk-build
    repository: moergo-sc/zmk
    branch: v25.05
    jobs: 8
    fallback_methods: ["local"]

# Flash method configurations  
flash_methods:
  - method_type: usb
    device_query: "vendor=Adafruit and serial~=GLV80-.* and removable=true"
    mount_timeout: 30
    copy_timeout: 60
    sync_after_copy: true
    fallback_methods: ["dfu"]
  - method_type: dfu
    vid: "0x1209"
    pid: "0x0080"
    interface: 0
    alt_setting: 0
    timeout: 30
    fallback_methods: []

firmwares:
  v25.05:
    version: "v25.05"
    description: "Stable MoErgo firmware v25.05"
    build_options:
      repository: "moergo-sc/zmk"
      branch: "v25.05"

  v25.04-beta.1:
    version: "v25.04-beta.1"
    description: "Beta MoErgo firmware v25.04-beta.1"
    build_options:
      repository: "moergo-sc/zmk"
      branch: "v25.04-beta.1"

  v25.01:
    version: "v25.01"
    description: "Stable MoErgo firmware v25.01"
    build_options:
      repository: "moergo-sc/zmk"
      branch: "v25.01"

  pr36:
    version: "pr36.per-key-rgb"
    description: "PR36 with per-key RGB support"
    build_options:
      repository: "moergo-sc/zmk"
      branch: "pull/36/head"
    kconfig:
      EXPERIMENTAL_RGB_LAYER:
        name: "CONFIG_EXPERIMENTAL_RGB_LAYER"
        type: "bool"
        default: false
        description: "Enables per-layer RGB settings"

# Additional includes specific to layout generation
keymap:
  includes:
    - "#include <dt-bindings/zmk/outputs.h>"
    - "#include <dt-bindings/zmk/bt.h>"
    - "#include <dt-bindings/zmk/rgb.h>"

  # Glove80-specific kconfig options
  kconfig_options:
    COMBO_MAX_PRESSED_COMBOS:
      name: "CONFIG_ZMK_COMBO_MAX_PRESSED_COMBOS"
      type: "int"
      default: 4
      description: "Maximum number of currently pressed combos. For detail ZMK documentation see CONFIG_ZMK_COMBO_MAX_PRESSED_COMBOS."

    COMBO_MAX_COMBOS_PER_KEY:
      name: "CONFIG_ZMK_COMBO_MAX_COMBOS_PER_KEY"
      type: "int"
      default: 5
      description: "Maximum number of active combos that use the same key position. For detail ZMK documentation see CONFIG_ZMK_COMBO_MAX_COMBOS_PER_KEY."

    COMBO_MAX_KEYS_PER_COMBO:
      name: "CONFIG_ZMK_COMBO_MAX_KEYS_PER_COMBO"
      type: "int"
      default: 4
      description: "Maximum number of keys to press to activate a combo. For detail ZMK documentation see CONFIG_ZMK_COMBO_MAX_KEYS_PER_COMBO."

    BEHAVIORS_QUEUE_SIZE:
      name: "CONFIG_ZMK_BEHAVIORS_QUEUE_SIZE"
      type: "int"
      default: 64
      description: "Maximum number of behaviors to allow queueing from a macro or other complex behavior. For detail ZMK documentation see CONFIG_ZMK_BEHAVIORS_QUEUE_SIZE."

    KSCAN_DEBOUNCE_PRESS_MS:
      name: "CONFIG_ZMK_KSCAN_DEBOUNCE_PRESS_MS"
      type: "int"
      default: 5
      description: "Keyscan press debounce in milliseconds. For detail ZMK documentation see CONFIG_ZMK_KSCAN_DEBOUNCE_PRESS_MS."

    KSCAN_DEBOUNCE_RELEASE_MS:
      name: "CONFIG_ZMK_KSCAN_DEBOUNCE_RELEASE_MS"
      type: "int"
      default: 5
      description: "Keyscan release debounce in milliseconds. For detail ZMK documentation see CONFIG_ZMK_KSCAN_DEBOUNCE_RELEASE_MS."

    HID_POINTING:
      name: "CONFIG_ZMK_POINTING"
      type: "bool"
      default: false
      description: "Enables mouse emulation capability. Re-pair your keyboard with your host via Bluetooth after enabling this feature."

    HID_NKRO:
      name: "CONFIG_ZMK_HID_REPORT_TYPE_NKRO"
      type: "bool"
      default: true
      description: "Enable full N-key roll over"

    HID_FULL_CONSUMER_REPORT:
      name: "CONFIG_ZMK_HID_CONSUMER_REPORT_USAGES_FULL"
      type: "bool"
      default: true
      description: "Enable all consumer key codes, but may have compatibility issues with some host OSes."

    HID_SEPARATE_MOD_RELEASE_REPORT:
      name: "CONFIG_ZMK_HID_SEPARATE_MOD_RELEASE_REPORT"
      type: "bool"
      default: false
      description: "Send modifier release event after non-modifier release event. This is available only for PR31, and not yet in production firmware."

    USB_LOGGING:
      name: "CONFIG_ZMK_USB_LOGGING"
      type: "bool"
      default: false
      description: "For debugging only; do not set this unless instructed by MoErgo. USB Logging is known to cause change in timing-sensitive behavior."

    INPUT_LOG_LEVEL_DBG:
      name: "CONFIG_INPUT_LOG_LEVEL_DBG"
      type: "bool"
      default: false
      description: "For debugging only; do not set this unless instructed by MoErgo. DEBUG log level is known to cause change in timing-sensitive behavior"

    SYSTEM_WORKQUEUE_STACK_SIZE:
      name: "CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE"
      type: "int"
      default: 2048
      description: "For debugging only; do not set this unless instructed by MoErgo."

    HW_STACK_PROTECTION:
      name: "CONFIG_HW_STACK_PROTECTION"
      type: "bool"
      default: false
      description: "For debugging only; do not set this unless instructed by MoErgo."

    EXPERIMENTAL_RGB_UNDERGLOW_AUTO_OFF_IDLE:
      name: "CONFIG_EXPERIMENTAL_RGB_UNDERGLOW_AUTO_OFF_IDLE"
      type: "bool"
      default: false
      description: "To save battery, turn off the RGB when the keyboard is not used for 30s."

  keymap_dtsi: |
    /*
    * Copyright (c) 2020 The ZMK Contributors
    * Copyright (c) 2025 Innaworks Development Limited, trading as MoErgo
    *
    * SPDX-License-Identifier: MIT
    */
    /* THIS FILE WAS GENERATED BY GLOVEBOX
    *
    * This file was generated automatically. You may or may not want to
    * edit it directly.
    */
    /* Include all behavior includes needed */
    {{ resolved_includes }}
    /* Automatically generated layer name #define */
    {{ layer_defines }}
    /* To deal with the situation where there is no Lower layer, to keep &lower happy */
    #ifndef LAYER_Lower
    #define LAYER_Lower 0
    #endif
    /* Custom Device-tree */
    {% if custom_devicetree %}
    {{ custom_devicetree }}
    {% endif %}
    /* Input Listeners */
    {# Render generated DTS from inputListeners JSON data #}
    {% if input_listeners_dtsi %}
    {{ input_listeners_dtsi }}
    {% endif %}
    /* System behavior and Macros */
    {# Render content read from system_behaviors.dts #}
    {{ system_behaviors_dts }}
    /* #define for key positions */
    {# Render content read from key_position.h #}
    {{ key_position_header }}
    /* Custom Defined Behaviors */
    / {
    {% if custom_defined_behaviors %}
    {{ custom_defined_behaviors }}
    {% else %}
    {% endif %}
    };
    /* Automatically generated macro definitions */
    / {
        macros {
    {% if user_macros_dtsi %}
    {{ user_macros_dtsi }}
    {% endif %}
        };
    };
    /* Automatically generated behavior definitions */
    / {
        behaviors {
    {% if user_behaviors_dtsi %}
    {{ user_behaviors_dtsi }}
    {% endif %}
        };
    };
    /* Automatically generated combos definitions */
    {% if combos_dtsi -%}
    / {
    {{ combos_dtsi }}
    };
    {% endif %}
    /* Automatically generated keymap */
    / {
    {{ keymap_node }}
    };

  system_behaviors_dts: |
    / {
        behaviors {
            // For the "layer" key, it'd nice to be able to use it as either a shift or a toggle.
            // Configure it as a tap dance, so the first tap (or hold) is a &mo and the second tap is a &to
            lower: lower {
                compatible = "zmk,behavior-tap-dance";
                label = "LAYER_TAP_DANCE";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&mo LAYER_Lower>, <&to LAYER_Lower>;
            };
        };
    };

    / {
        macros {
            rgb_ug_status_macro: rgb_ug_status_macro {
                label = "RGB_UG_STATUS";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&rgb_ug RGB_STATUS>;
            };
        };
    };


    / {
    #ifdef BT_DISC_CMD
        behaviors {
            bt_0: bt_0 {
                compatible = "zmk,behavior-tap-dance";
                label = "BT_0";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&bt_select_0>, <&bt BT_DISC 0>;
            };
            bt_1: bt_1 {
                compatible = "zmk,behavior-tap-dance";
                label = "BT_1";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&bt_select_1>, <&bt BT_DISC 1>;
            };
            bt_2: bt_2 {
                compatible = "zmk,behavior-tap-dance";
                label = "BT_2";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&bt_select_2>, <&bt BT_DISC 2>;
            };
            bt_3: bt_3 {
                compatible = "zmk,behavior-tap-dance";
                label = "BT_3";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&bt_select_3>, <&bt BT_DISC 3>;
            };
        };
        macros {
            bt_select_0: bt_select_0 {
                label = "BT_SELECT_0";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 0>;
            };
            bt_select_1: bt_select_1 {
                label = "BT_SELECT_1";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 1>;
            };
            bt_select_2: bt_select_2 {
                label = "BT_SELECT_2";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 2>;
            };
            bt_select_3: bt_select_3 {
                label = "BT_SELECT_3";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 3>;
            };
        };
    #else
        macros {
            bt_0: bt_0 {
                label = "BT_0";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 0>;
            };
            bt_1: bt_1 {
                label = "BT_1";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 1>;
            };
            bt_2: bt_2 {
                label = "BT_2";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 2>;
            };
            bt_3: bt_3 {
                label = "BT_3";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 3>;
            };
        };
    #endif
    };

    / {
        behaviors {
            magic: magic {
                compatible = "zmk,behavior-hold-tap";
                label = "MAGIC_HOLD_TAP";
                #binding-cells = <2>;
                flavor = "tap-preferred";
                tapping-term-ms = <200>;
                bindings = <&mo>, <&rgb_ug_status_macro>;
            };
        };
    };

  key_position_header: |
    #define POS_LH_T1 52
    #define POS_LH_T2 53
    #define POS_LH_T3 54
    #define POS_LH_T4 69
    #define POS_LH_T5 70
    #define POS_LH_T6 71
    #define POS_LH_C1R2 15
    #define POS_LH_C1R3 27
    #define POS_LH_C1R4 39
    #define POS_LH_C1R5 51
    #define POS_LH_C2R1 4
    #define POS_LH_C2R2 14
    #define POS_LH_C2R3 26
    #define POS_LH_C2R4 38
    #define POS_LH_C2R5 50
    #define POS_LH_C2R6 68
    #define POS_LH_C3R1 3
    #define POS_LH_C3R2 13
    #define POS_LH_C3R3 25
    #define POS_LH_C3R4 37
    #define POS_LH_C3R5 49
    #define POS_LH_C3R6 67
    #define POS_LH_C4R1 2
    #define POS_LH_C4R2 12
    #define POS_LH_C4R3 24
    #define POS_LH_C4R4 36
    #define POS_LH_C4R5 48
    #define POS_LH_C4R6 66
    #define POS_LH_C5R1 1
    #define POS_LH_C5R2 11
    #define POS_LH_C5R3 23
    #define POS_LH_C5R4 35
    #define POS_LH_C5R5 47
    #define POS_LH_C5R6 65
    #define POS_LH_C6R1 0
    #define POS_LH_C6R2 10
    #define POS_LH_C6R3 22
    #define POS_LH_C6R4 34
    #define POS_LH_C6R5 46
    #define POS_LH_C6R6 64
    #define POS_RH_T1 57
    #define POS_RH_T2 56
    #define POS_RH_T3 55
    #define POS_RH_T4 74
    #define POS_RH_T5 73
    #define POS_RH_T6 72
    #define POS_RH_C1R2 16
    #define POS_RH_C1R3 28
    #define POS_RH_C1R4 40
    #define POS_RH_C1R5 58
    #define POS_RH_C2R1 5
    #define POS_RH_C2R2 17
    #define POS_RH_C2R3 29
    #define POS_RH_C2R4 41
    #define POS_RH_C2R5 59
    #define POS_RH_C2R6 75
    #define POS_RH_C3R1 6
    #define POS_RH_C3R2 18
    #define POS_RH_C3R3 30
    #define POS_RH_C3R4 42
    #define POS_RH_C3R5 60
    #define POS_RH_C3R6 76
    #define POS_RH_C4R1 7
    #define POS_RH_C4R2 19
    #define POS_RH_C4R3 31
    #define POS_RH_C4R4 43
    #define POS_RH_C4R5 61
    #define POS_RH_C4R6 77
    #define POS_RH_C5R1 8
    #define POS_RH_C5R2 20
    #define POS_RH_C5R3 32
    #define POS_RH_C5R4 44
    #define POS_RH_C5R5 62
    #define POS_RH_C5R6 78
    #define POS_RH_C6R1 9
    #define POS_RH_C6R2 21
    #define POS_RH_C6R3 33
    #define POS_RH_C6R4 45
    #define POS_RH_C6R5 63
    #define POS_RH_C6R6 79