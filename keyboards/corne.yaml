keyboard: "corne"
description: "Corne Cherry v3 42-key split ergonomic keyboard"
vendor: "foostan"
key_count: 42

# Include common configurations
includes:
  - "config/common/default_includes.yaml"
  - "config/common/formatting.yaml"
  - "config/common/bluetooth_kconfig.yaml"
  - "config/common/power_kconfig.yaml"
  - "config/display/defaults.yaml"

# Include behavior configurations
behaviors:
  includes:
    - "config/behaviors/zmk_core.yaml"
    - "config/behaviors/zmk_bluetooth.yaml"
    - "config/behaviors/zmk_macros.yaml"

# Include ZMK configuration
zmk:
  includes:
    - "config/zmk/validation_limits.yaml"
    - "config/zmk/patterns.yaml"

# Display configuration specific to Corne layout
display:
  layout_structure:
    rows:
      row_0:
        - [0, 1, 2, 3, 4, 5]
        - [6, 7, 8, 9, 10, 11]
      row_1:
        - [12, 13, 14, 15, 16, 17]
        - [18, 19, 20, 21, 22, 23]
      row_2:
        - [24, 25, 26, 27, 28, 29]
        - [30, 31, 32, 33, 34, 35]
      thumb_row:
        - [36, 37, 38]
        - [39, 40, 41]

# Compile method configurations
compile_methods:
  - method_type: docker
    image: zmkfirmware/zmk-build-arm:stable
    repository: zmkfirmware/zmk
    branch: main
    jobs: 4
    fallback_methods: ["local"]

# Flash method configurations
flash_methods:
  - method_type: usb
    device_query: "vendor=Adafruit and product~=.*nRF52.*Bootloader and removable=true"
    mount_timeout: 30
    copy_timeout: 60
    sync_after_copy: true
    fallback_methods: ["dfu"]
  - method_type: dfu
    vid: "0x1209"
    pid: "0x0514"
    interface: 0
    alt_setting: 0
    timeout: 30
    fallback_methods: []

firmwares:
  main:
    version: "main"
    description: "Latest ZMK firmware from main branch"
    build_options:
      repository: "zmkfirmware/zmk"
      branch: "main"

  v3.5:
    version: "v3.5"
    description: "ZMK firmware v3.5 stable release"
    build_options:
      repository: "zmkfirmware/zmk"
      branch: "v3.5-branch"

  v3.2:
    version: "v3.2"
    description: "ZMK firmware v3.2 stable release"
    build_options:
      repository: "zmkfirmware/zmk"
      branch: "v3.2-branch"

# Keymap configuration specific to Corne
keymap:
  includes:
    - "#include <dt-bindings/zmk/keys.h>"
    - "#include <dt-bindings/zmk/bt.h>"
    - "#include <dt-bindings/zmk/outputs.h>"

  # Corne-specific formatting
  formatting:
    rows:
      # Corne 42-key layout representation
      - [0, 1, 2, 3, 4, 5, -1, 6, 7, 8, 9, 10, 11]
      - [12, 13, 14, 15, 16, 17, -1, 18, 19, 20, 21, 22, 23]
      - [24, 25, 26, 27, 28, 29, -1, 30, 31, 32, 33, 34, 35]
      - [-1, -1, -1, 36, 37, 38, -1, 39, 40, 41, -1, -1, -1]

  # Corne-specific kconfig options
  kconfig_options:
    COMBO_MAX_PRESSED_COMBOS:
      name: "CONFIG_ZMK_COMBO_MAX_PRESSED_COMBOS"
      type: "int"
      default: 4
      description: "Maximum number of currently pressed combos"

    COMBO_MAX_COMBOS_PER_KEY:
      name: "CONFIG_ZMK_COMBO_MAX_COMBOS_PER_KEY"
      type: "int"
      default: 5
      description: "Maximum number of combos that use the same key position"

    COMBO_MAX_KEYS_PER_COMBO:
      name: "CONFIG_ZMK_COMBO_MAX_KEYS_PER_COMBO"
      type: "int"
      default: 3
      description: "Maximum number of keys in a combo"

    BEHAVIORS_QUEUE_SIZE:
      name: "CONFIG_ZMK_BEHAVIORS_QUEUE_SIZE"
      type: "int"
      default: 64
      description: "Maximum number of behaviors to allow queueing"

    KSCAN_DEBOUNCE_PRESS_MS:
      name: "CONFIG_ZMK_KSCAN_DEBOUNCE_PRESS_MS"
      type: "int"
      default: 5
      description: "Keyscan press debounce in milliseconds"

    KSCAN_DEBOUNCE_RELEASE_MS:
      name: "CONFIG_ZMK_KSCAN_DEBOUNCE_RELEASE_MS"
      type: "int"
      default: 5
      description: "Keyscan release debounce in milliseconds"

    HID_NKRO:
      name: "CONFIG_ZMK_HID_REPORT_TYPE_NKRO"
      type: "bool"
      default: true
      description: "Enable full N-key roll over"

    HID_CONSUMER_REPORT_USAGES_FULL:
      name: "CONFIG_ZMK_HID_CONSUMER_REPORT_USAGES_FULL"
      type: "bool"
      default: true
      description: "Enable all consumer key codes"

    USB_LOGGING:
      name: "CONFIG_ZMK_USB_LOGGING"
      type: "bool"
      default: false
      description: "Enable USB logging for debugging"

    SPLIT_BLE_PREF_LATENCY:
      name: "CONFIG_ZMK_SPLIT_BLE_PREF_LATENCY"
      type: "int"
      default: 30
      description: "Preferred latency for split BLE connection"

  keymap_dtsi: |
    /*
    * Copyright (c) 2020 The ZMK Contributors
    *
    * SPDX-License-Identifier: MIT
    */
    /* THIS FILE WAS GENERATED BY GLOVEBOX
    *
    * This file was generated automatically. You may or may not want to
    * edit it directly.
    */
    /* Include all behavior includes needed */
    {{ resolved_includes }}
    /* Automatically generated layer name #define */
    {{ layer_defines }}
    /* To deal with the situation where there is no Lower layer, to keep &lower happy */
    #ifndef LAYER_Lower
    #define LAYER_Lower 0
    #endif
    /* Custom Device-tree */
    {% if custom_devicetree %}
    {{ custom_devicetree }}
    {% endif %}
    /* Input Listeners */
    {# Render generated DTS from inputListeners JSON data #}
    {% if input_listeners_dtsi %}
    {{ input_listeners_dtsi }}
    {% endif %}
    /* System behavior and Macros */
    {# Render content read from system_behaviors.dts #}
    {{ system_behaviors_dts }}
    /* #define for key positions */
    {# Render content read from key_position.h #}
    {{ key_position_header }}
    /* Custom Defined Behaviors */
    / {
    {% if custom_defined_behaviors %}
    {{ custom_defined_behaviors }}
    {% else %}
    {% endif %}
    };
    /* Automatically generated macro definitions */
    / {
        macros {
    {% if user_macros_dtsi %}
    {{ user_macros_dtsi }}
    {% endif %}
        };
    };
    /* Automatically generated behavior definitions */
    / {
        behaviors {
    {% if user_behaviors_dtsi %}
    {{ user_behaviors_dtsi }}
    {% endif %}
        };
    };
    /* Automatically generated combos definitions */
    {% if combos_dtsi -%}
    / {
    {{ combos_dtsi }}
    };
    {% endif %}
    /* Automatically generated keymap */
    / {
    {{ keymap_node }}
    };

  system_behaviors_dts: |
    / {
        behaviors {
            // Tap dance for layer access
            lower: lower {
                compatible = "zmk,behavior-tap-dance";
                label = "LAYER_TAP_DANCE";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&mo LAYER_Lower>, <&to LAYER_Lower>;
            };
        };
    };

    / {
        macros {
            // Bluetooth profile selection macros
            bt_0: bt_0 {
                label = "BT_0";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 0>;
            };
            bt_1: bt_1 {
                label = "BT_1";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 1>;
            };
            bt_2: bt_2 {
                label = "BT_2";
                compatible = "zmk,behavior-macro";
                #binding-cells = <0>;
                bindings
                    = <&out OUT_BLE>,
                      <&bt BT_SEL 2>;
            };
        };
    };

  key_position_header: |
    // Corne key position definitions
    #define LT0  0  // left-top row
    #define LT1  1
    #define LT2  2
    #define LT3  3
    #define LT4  4
    #define LT5  5
    #define RT0  6  // right-top row
    #define RT1  7
    #define RT2  8
    #define RT3  9
    #define RT4 10
    #define RT5 11
    #define LM0 12  // left-middle row
    #define LM1 13
    #define LM2 14
    #define LM3 15
    #define LM4 16
    #define LM5 17
    #define RM0 18  // right-middle row
    #define RM1 19
    #define RM2 20
    #define RM3 21
    #define RM4 22
    #define RM5 23
    #define LB0 24  // left-bottom row
    #define LB1 25
    #define LB2 26
    #define LB3 27
    #define LB4 28
    #define LB5 29
    #define RB0 30  // right-bottom row
    #define RB1 31
    #define RB2 32
    #define RB3 33
    #define RB4 34
    #define RB5 35
    #define LH0 36  // left thumb cluster
    #define LH1 37
    #define LH2 38
    #define RH0 39  // right thumb cluster
    #define RH1 40
    #define RH2 41